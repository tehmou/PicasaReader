<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <style type="text/css">

        body {
            overflow: auto;
            overflow-x: hidden;
            -ms-overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        #list-container {
            position: absolute;
            margin-top: 8px;
            right: 8px;
        }

        #list-container img {
            display: block;
            width: 100px;
            margin-bottom: 5px;
        }

        #image-display {
            position: fixed;
            border: 1px solid black;
            top: 8px;
            left: 8px;
        }

    </style>

    <script type="text/javascript" src="lib/jquery-1.6.1.js"></script>
    <script type="text/javascript" src="lib/less-1.0.41.min.js"></script>
    <script type="text/javascript" src="lib/underscore.js"></script>
    <script type="text/javascript" src="lib/backbone.js"></script>

    <script type="text/javascript">

        var initFeed;

        (function () {

            var defaultTransformation = function () {
                //var transform = "rotate(" + Math.floor(90*(0.5-ratio)) + "deg)";
                //item.img.css("-moz-transform", transform);
                //item.img.css("-webkit-transform", transform);
                //item.img.css("transform", transform);
                this.img.css("opacity", 1.0 - Math.abs(this.ratio - 0.5) * 2.0);
            };

            var calculatePositionVertical = function () {
                var top = $(this.img).offset().top;
                this.pos = top + $(this.img).height()/2;
            };

            var createListItemEl = function () {
                this.el = $('<div></div>');
                this.img = $('<img alt="" src="' + this.dataEntry["media$group"]["media$thumbnail"][1].url + '"/>');
                $(this.el).append(this.img);
            };

            var listItem = {
                refresh: defaultTransformation,
                calculatePosition: calculatePositionVertical,
                init: createListItemEl
            };

            var feed, windowHeight, imageInfos = [];

            initFeed = function (data) {
                console.log(data);
                feed = data.feed;
            };

            function onResize() {
                $("#image-display")
                        .attr("height", window.innerHeight - 20);
                windowHeight = $(window).height();
            }

            function onScroll() {
                var scrollPos = $(window).scrollTop();
                var scrollArea = windowHeight;

                for (var i = 0; i < imageInfos.length; i++) {
                    var item = imageInfos[i];
                    var ratio = (item.pos - scrollPos) / scrollArea;
                    ratio = Math.min(ratio, 1.0);
                    ratio = Math.max(ratio, 0.0);
                    item.ratio = ratio;
                    item.refresh();
                }
            }

            function calculateDimensions() {
                _.each(imageInfos, function (value) {
                    value.calculatePosition();
                });
                onScroll();
            }

            $(function () {
                _.each(feed.entry, function (entry) {
                    var item = _.extend({ dataEntry: entry }, listItem);
                    item.init();
                    $("#list-container").append(item.el);
                    $(item.el).click(function () {
                        $("#image-display").attr("src", entry.content.src);
                    });
                    $("img", item.el)[0].onload = calculateDimensions;
                    imageInfos[imageInfos.length] = item;
                });

                $(window)
                        .scroll(onScroll)
                        .resize(onResize);

                onResize();
                onScroll();

                $($("#list-container").children()[0]).trigger("click");
            });

        })();


    </script>
    <script type="text/javascript" src="https://picasaweb.google.com/data/feed/base/user/101239827031429117300/albumid/5648146613498236001?alt=json-in-script&callback=initFeed&kind=photo&authkey=Gv1sRgCNGsuZv7wvTvbw"></script>
</head>
<body>
    <img id="image-display" alt=""/>
    <div id="list-container"></div>
</body>
</html>
