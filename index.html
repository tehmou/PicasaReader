<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <style type="text/css">

        body {
            overflow: auto;
            overflow-y: hidden;
            -ms-overflow-y: hidden;
            margin: 0;
            padding: 0;
        }

        #top-container {
            margin-left: 5px;
        }

        #list-container img {
            display: inline;
            height: 100px;
            margin: 5px 5px 0 0;
        }

        #image-container {
            position: fixed;
            top: 113px;
            bottom: 8px;
            left: 8px;
            right: 8px;
            text-align: center;
        }

        #image-display {
            border: 1px solid black;
        }

    </style>

    <script type="text/javascript" src="lib/jquery-1.6.1.js"></script>
    <script type="text/javascript" src="lib/less-1.0.41.min.js"></script>
    <script type="text/javascript" src="lib/underscore.js"></script>
    <script type="text/javascript" src="lib/backbone.js"></script>

    <script type="text/javascript">

        var initFeed;
        
        (function () {

            var feed, windowWidth, imageInfos = [];

            initFeed = function (data) {
                feed = data.feed;
            };

            function onResize() {
                $("#image-display")
                        .attr("height", window.innerHeight - 140);
                windowWidth = $(window).width();
            }

            function onScroll() {
                var scrollLeft = $(window).scrollLeft();

                for (var i = 0; i < imageInfos.length; i++) {
                    var item = imageInfos[i];
                    var ratio = (item.pos - scrollLeft) / windowWidth;
                    ratio = Math.min(ratio, 1.0);
                    ratio = Math.max(ratio, 0.0);

                    var transform = "rotate(" + Math.floor(90*(1.0-ratio)) + "deg)";
                    //item.img.css("-moz-transform", transform);
                    //item.img.css("-webkit-transform", transform);
                    //item.img.css("transform", transform);
                    //item.img.css("opacity", 1.0 - Math.abs(ratio - 0.5) * 2.0);
                }
            }

            function calculateDimensions() {
                _.each(imageInfos, function (value, index) {
                    var left = $(value.img).offset().left;
                    imageInfos[index].pos = left + $(value.img).width()/2;
                });
                onScroll();
            }

            $(function () {
                for (var i = 0; i < 4; i++) {
                    _.each(feed.entry, function (entry) {
                        var elem = $('<td></td>');
                        var img = $('<img alt="" src="' + entry.content.src + '"/>');
                        $(elem).append(img);
                        $("#list-container").append(elem);
                        elem.click(function () {
                            $("#image-display").attr("src", entry.content.src);
                        });
                        img[0].onload = calculateDimensions;

                        imageInfos[imageInfos.length] = {
                            src: entry.content.src,
                            el: elem,
                            img: img
                        };
                    });
                }

                $(window)
                        .scroll(onScroll)
                        .resize(onResize);

                onResize();
                onScroll();

                $($("#list-container").children()[0]).trigger("click");
            });

        })();


    </script>
    <script type="text/javascript" src="https://picasaweb.google.com/data/feed/base/user/101239827031429117300/albumid/5641510119136361361?alt=json-in-script&callback=initFeed&kind=photo&authkey=Gv1sRgCN_P-e3ptaKo8gE"></script>
</head>
<body>
    <div id="image-container">
        <img id="image-display" alt=""/>
    </div>
    <div id="top-container">
        <table><tbody><tr id="list-container"></tr></tbody></table>
    </div>
</body>
</html>
