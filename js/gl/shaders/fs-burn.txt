#ifdef GL_ES
precision highp float;
#endif

uniform vec2 resolution;
uniform sampler2D tex0;
uniform sampler2D tex1;
uniform float ratio;
varying vec2 picturePosition;

void main(void) {
    vec2 p = picturePosition.xy;
    vec2 texCoord = vec2(p.s*.5+.5,.5-p.t*.5);
    vec4 o0 = texture2D(tex0,texCoord);
    vec4 o1 = texture2D(tex1,texCoord);

    float burnRatio = (o1.x-ratio/.7)+.3;

    float alpha = clamp(burnRatio/.04,0.,1.);

    float overlayColorMagnitude = 1.0-clamp(burnRatio/0.3,0.0,1.0);
    vec3 overlayColor = vec3(-.3*overlayColorMagnitude,-.7*overlayColorMagnitude,-1.0);
    vec3 colorAdjust = overlayColorMagnitude*overlayColor;

    gl_FragColor = vec4(o0.xyz+colorAdjust, alpha);
}